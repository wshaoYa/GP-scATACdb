[2024-03-20 16:23:41 +0800] [3351580] [DEBUG] Current configuration:
  config: gunicorn.py
  wsgi_app: None
  bind: ['0.0.0.0:8001']
  backlog: 2048
  workers: 4
  worker_class: uvicorn.workers.UvicornWorker
  threads: 2
  worker_connections: 2000
  max_requests: 0
  max_requests_jitter: 0
  timeout: 360000
  graceful_timeout: 30
  keepalive: 2
  limit_request_line: 4094
  limit_request_fields: 100
  limit_request_field_size: 8190
  reload: False
  reload_engine: auto
  reload_extra_files: []
  spew: False
  check_config: False
  print_config: False
  preload_app: False
  sendfile: None
  reuse_port: False
  chdir: /data/wshao/scATACdb/code
  daemon: True
  raw_env: []
  pidfile: None
  worker_tmp_dir: None
  user: 0
  group: 0
  umask: 0
  initgroups: False
  tmp_upload_dir: None
  secure_scheme_headers: {'X-FORWARDED-PROTOCOL': 'ssl', 'X-FORWARDED-PROTO': 'https', 'X-FORWARDED-SSL': 'on'}
  forwarded_allow_ips: ['127.0.0.1']
  accesslog: /data/wshao/scATACdb/code/gunicorn_access.log
  disable_redirect_access_to_syslog: False
  access_log_format: %(t)s %(p)s %(h)s "%(r)s" %(s)s %(L)s %(b)s %(f)s" "%(a)s"
  errorlog: /data/wshao/scATACdb/code/gunicorn_error.log
  loglevel: debug
  capture_output: False
  logger_class: gunicorn.glogging.Logger
  logconfig: None
  logconfig_dict: {}
  syslog_addr: udp://localhost:514
  syslog: False
  syslog_prefix: None
  syslog_facility: user
  enable_stdio_inheritance: False
  statsd_host: None
  dogstatsd_tags: 
  statsd_prefix: 
  proc_name: None
  default_proc_name: main:app
  pythonpath: None
  paste: None
  on_starting: <function OnStarting.on_starting at 0x7f66c46a2320>
  on_reload: <function OnReload.on_reload at 0x7f66c46a2440>
  when_ready: <function WhenReady.when_ready at 0x7f66c46a2560>
  pre_fork: <function Prefork.pre_fork at 0x7f66c46a2680>
  post_fork: <function Postfork.post_fork at 0x7f66c46a27a0>
  post_worker_init: <function PostWorkerInit.post_worker_init at 0x7f66c46a28c0>
  worker_int: <function WorkerInt.worker_int at 0x7f66c46a29e0>
  worker_abort: <function WorkerAbort.worker_abort at 0x7f66c46a2b00>
  pre_exec: <function PreExec.pre_exec at 0x7f66c46a2c20>
  pre_request: <function PreRequest.pre_request at 0x7f66c46a2d40>
  post_request: <function PostRequest.post_request at 0x7f66c46a2dd0>
  child_exit: <function ChildExit.child_exit at 0x7f66c46a2ef0>
  worker_exit: <function WorkerExit.worker_exit at 0x7f66c46a3010>
  nworkers_changed: <function NumWorkersChanged.nworkers_changed at 0x7f66c46a3130>
  on_exit: <function OnExit.on_exit at 0x7f66c46a3250>
  proxy_protocol: False
  proxy_allow_ips: ['127.0.0.1']
  keyfile: None
  certfile: None
  ssl_version: 2
  cert_reqs: 0
  ca_certs: None
  suppress_ragged_eofs: True
  do_handshake_on_connect: False
  ciphers: None
  raw_paste_global_conf: []
  strip_header_spaces: False
[2024-03-20 16:23:41 +0800] [3351580] [INFO] Starting gunicorn 20.1.0
[2024-03-20 16:23:41 +0800] [3351580] [DEBUG] Arbiter booted
[2024-03-20 16:23:41 +0800] [3351580] [INFO] Listening at: http://0.0.0.0:8001 (3351580)
[2024-03-20 16:23:41 +0800] [3351580] [INFO] Using worker: uvicorn.workers.UvicornWorker
[2024-03-20 16:23:41 +0800] [3351581] [INFO] Booting worker with pid: 3351581
[2024-03-20 16:23:42 +0800] [3351582] [INFO] Booting worker with pid: 3351582
[2024-03-20 16:23:42 +0800] [3351583] [INFO] Booting worker with pid: 3351583
[2024-03-20 16:23:42 +0800] [3351584] [INFO] Booting worker with pid: 3351584
[2024-03-20 16:23:42 +0800] [3351580] [DEBUG] 4 workers
[2024-03-20 16:23:49 +0800] [3351581] [INFO] Started server process [3351581]
[2024-03-20 16:23:49 +0800] [3351581] [INFO] Waiting for application startup.
[2024-03-20 16:23:49 +0800] [3351581] [INFO] Application startup complete.
[2024-03-20 16:23:49 +0800] [3351582] [INFO] Started server process [3351582]
[2024-03-20 16:23:49 +0800] [3351583] [INFO] Started server process [3351583]
[2024-03-20 16:23:49 +0800] [3351583] [INFO] Waiting for application startup.
[2024-03-20 16:23:49 +0800] [3351583] [INFO] Application startup complete.
[2024-03-20 16:23:49 +0800] [3351584] [INFO] Started server process [3351584]
[2024-03-20 16:23:49 +0800] [3351584] [INFO] Waiting for application startup.
[2024-03-20 16:23:49 +0800] [3351582] [INFO] Waiting for application startup.
[2024-03-20 16:23:49 +0800] [3351584] [INFO] Application startup complete.
[2024-03-20 16:23:49 +0800] [3351582] [INFO] Application startup complete.
[2024-03-20 16:50:40 +0800] [3358777] [DEBUG] Current configuration:
  config: gunicorn.py
  wsgi_app: None
  bind: ['0.0.0.0:8001']
  backlog: 2048
  workers: 4
  worker_class: uvicorn.workers.UvicornWorker
  threads: 2
  worker_connections: 2000
  max_requests: 0
  max_requests_jitter: 0
  timeout: 360000
  graceful_timeout: 30
  keepalive: 2
  limit_request_line: 4094
  limit_request_fields: 100
  limit_request_field_size: 8190
  reload: False
  reload_engine: auto
  reload_extra_files: []
  spew: False
  check_config: False
  print_config: False
  preload_app: False
  sendfile: None
  reuse_port: False
  chdir: /data/wshao/scATACdb/code
  daemon: True
  raw_env: []
  pidfile: None
  worker_tmp_dir: None
  user: 0
  group: 0
  umask: 0
  initgroups: False
  tmp_upload_dir: None
  secure_scheme_headers: {'X-FORWARDED-PROTOCOL': 'ssl', 'X-FORWARDED-PROTO': 'https', 'X-FORWARDED-SSL': 'on'}
  forwarded_allow_ips: ['127.0.0.1']
  accesslog: /data/wshao/scATACdb/code/gunicorn_access.log
  disable_redirect_access_to_syslog: False
  access_log_format: %(t)s %(p)s %(h)s "%(r)s" %(s)s %(L)s %(b)s %(f)s" "%(a)s"
  errorlog: /data/wshao/scATACdb/code/gunicorn_error.log
  loglevel: debug
  capture_output: False
  logger_class: gunicorn.glogging.Logger
  logconfig: None
  logconfig_dict: {}
  syslog_addr: udp://localhost:514
  syslog: False
  syslog_prefix: None
  syslog_facility: user
  enable_stdio_inheritance: False
  statsd_host: None
  dogstatsd_tags: 
  statsd_prefix: 
  proc_name: None
  default_proc_name: main:app
  pythonpath: None
  paste: None
  on_starting: <function OnStarting.on_starting at 0x7f63d0f66320>
  on_reload: <function OnReload.on_reload at 0x7f63d0f66440>
  when_ready: <function WhenReady.when_ready at 0x7f63d0f66560>
  pre_fork: <function Prefork.pre_fork at 0x7f63d0f66680>
  post_fork: <function Postfork.post_fork at 0x7f63d0f667a0>
  post_worker_init: <function PostWorkerInit.post_worker_init at 0x7f63d0f668c0>
  worker_int: <function WorkerInt.worker_int at 0x7f63d0f669e0>
  worker_abort: <function WorkerAbort.worker_abort at 0x7f63d0f66b00>
  pre_exec: <function PreExec.pre_exec at 0x7f63d0f66c20>
  pre_request: <function PreRequest.pre_request at 0x7f63d0f66d40>
  post_request: <function PostRequest.post_request at 0x7f63d0f66dd0>
  child_exit: <function ChildExit.child_exit at 0x7f63d0f66ef0>
  worker_exit: <function WorkerExit.worker_exit at 0x7f63d0f67010>
  nworkers_changed: <function NumWorkersChanged.nworkers_changed at 0x7f63d0f67130>
  on_exit: <function OnExit.on_exit at 0x7f63d0f67250>
  proxy_protocol: False
  proxy_allow_ips: ['127.0.0.1']
  keyfile: None
  certfile: None
  ssl_version: 2
  cert_reqs: 0
  ca_certs: None
  suppress_ragged_eofs: True
  do_handshake_on_connect: False
  ciphers: None
  raw_paste_global_conf: []
  strip_header_spaces: False
[2024-03-20 16:50:40 +0800] [3358777] [INFO] Starting gunicorn 20.1.0
[2024-03-20 16:50:40 +0800] [3358777] [DEBUG] Arbiter booted
[2024-03-20 16:50:40 +0800] [3358777] [INFO] Listening at: http://0.0.0.0:8001 (3358777)
[2024-03-20 16:50:40 +0800] [3358777] [INFO] Using worker: uvicorn.workers.UvicornWorker
[2024-03-20 16:50:40 +0800] [3358778] [INFO] Booting worker with pid: 3358778
[2024-03-20 16:50:40 +0800] [3358779] [INFO] Booting worker with pid: 3358779
[2024-03-20 16:50:40 +0800] [3358780] [INFO] Booting worker with pid: 3358780
[2024-03-20 16:50:41 +0800] [3358781] [INFO] Booting worker with pid: 3358781
[2024-03-20 16:50:41 +0800] [3358777] [DEBUG] 4 workers
[2024-03-20 16:50:42 +0800] [3358778] [INFO] Started server process [3358778]
[2024-03-20 16:50:42 +0800] [3358778] [INFO] Waiting for application startup.
[2024-03-20 16:50:42 +0800] [3358778] [INFO] Application startup complete.
[2024-03-20 16:50:42 +0800] [3358779] [INFO] Started server process [3358779]
[2024-03-20 16:50:42 +0800] [3358779] [INFO] Waiting for application startup.
[2024-03-20 16:50:42 +0800] [3358779] [INFO] Application startup complete.
[2024-03-20 16:50:42 +0800] [3358780] [INFO] Started server process [3358780]
[2024-03-20 16:50:42 +0800] [3358780] [INFO] Waiting for application startup.
[2024-03-20 16:50:42 +0800] [3358780] [INFO] Application startup complete.
[2024-03-20 16:50:42 +0800] [3358781] [INFO] Started server process [3358781]
[2024-03-20 16:50:42 +0800] [3358781] [INFO] Waiting for application startup.
[2024-03-20 16:50:42 +0800] [3358781] [INFO] Application startup complete.
[2024-03-20 21:07:45 +0800] [3425226] [DEBUG] Current configuration:
  config: gunicorn.py
  wsgi_app: None
  bind: ['0.0.0.0:8001']
  backlog: 2048
  workers: 4
  worker_class: uvicorn.workers.UvicornWorker
  threads: 2
  worker_connections: 2000
  max_requests: 0
  max_requests_jitter: 0
  timeout: 360000
  graceful_timeout: 30
  keepalive: 2
  limit_request_line: 4094
  limit_request_fields: 100
  limit_request_field_size: 8190
  reload: False
  reload_engine: auto
  reload_extra_files: []
  spew: False
  check_config: False
  print_config: False
  preload_app: False
  sendfile: None
  reuse_port: False
  chdir: /data/wshao/scATACdb/code
  daemon: True
  raw_env: []
  pidfile: None
  worker_tmp_dir: None
  user: 0
  group: 0
  umask: 0
  initgroups: False
  tmp_upload_dir: None
  secure_scheme_headers: {'X-FORWARDED-PROTOCOL': 'ssl', 'X-FORWARDED-PROTO': 'https', 'X-FORWARDED-SSL': 'on'}
  forwarded_allow_ips: ['127.0.0.1']
  accesslog: /data/wshao/scATACdb/code/gunicorn_access.log
  disable_redirect_access_to_syslog: False
  access_log_format: %(t)s %(p)s %(h)s "%(r)s" %(s)s %(L)s %(b)s %(f)s" "%(a)s"
  errorlog: /data/wshao/scATACdb/code/gunicorn_error.log
  loglevel: debug
  capture_output: False
  logger_class: gunicorn.glogging.Logger
  logconfig: None
  logconfig_dict: {}
  syslog_addr: udp://localhost:514
  syslog: False
  syslog_prefix: None
  syslog_facility: user
  enable_stdio_inheritance: False
  statsd_host: None
  dogstatsd_tags: 
  statsd_prefix: 
  proc_name: None
  default_proc_name: main:app
  pythonpath: None
  paste: None
  on_starting: <function OnStarting.on_starting at 0x7ff421f22320>
  on_reload: <function OnReload.on_reload at 0x7ff421f22440>
  when_ready: <function WhenReady.when_ready at 0x7ff421f22560>
  pre_fork: <function Prefork.pre_fork at 0x7ff421f22680>
  post_fork: <function Postfork.post_fork at 0x7ff421f227a0>
  post_worker_init: <function PostWorkerInit.post_worker_init at 0x7ff421f228c0>
  worker_int: <function WorkerInt.worker_int at 0x7ff421f229e0>
  worker_abort: <function WorkerAbort.worker_abort at 0x7ff421f22b00>
  pre_exec: <function PreExec.pre_exec at 0x7ff421f22c20>
  pre_request: <function PreRequest.pre_request at 0x7ff421f22d40>
  post_request: <function PostRequest.post_request at 0x7ff421f22dd0>
  child_exit: <function ChildExit.child_exit at 0x7ff421f22ef0>
  worker_exit: <function WorkerExit.worker_exit at 0x7ff421f23010>
  nworkers_changed: <function NumWorkersChanged.nworkers_changed at 0x7ff421f23130>
  on_exit: <function OnExit.on_exit at 0x7ff421f23250>
  proxy_protocol: False
  proxy_allow_ips: ['127.0.0.1']
  keyfile: None
  certfile: None
  ssl_version: 2
  cert_reqs: 0
  ca_certs: None
  suppress_ragged_eofs: True
  do_handshake_on_connect: False
  ciphers: None
  raw_paste_global_conf: []
  strip_header_spaces: False
[2024-03-20 21:07:45 +0800] [3425226] [INFO] Starting gunicorn 20.1.0
[2024-03-20 21:07:45 +0800] [3425226] [DEBUG] Arbiter booted
[2024-03-20 21:07:45 +0800] [3425226] [INFO] Listening at: http://0.0.0.0:8001 (3425226)
[2024-03-20 21:07:45 +0800] [3425226] [INFO] Using worker: uvicorn.workers.UvicornWorker
[2024-03-20 21:07:45 +0800] [3425227] [INFO] Booting worker with pid: 3425227
[2024-03-20 21:07:45 +0800] [3425228] [INFO] Booting worker with pid: 3425228
[2024-03-20 21:07:46 +0800] [3425229] [INFO] Booting worker with pid: 3425229
[2024-03-20 21:07:46 +0800] [3425230] [INFO] Booting worker with pid: 3425230
[2024-03-20 21:07:46 +0800] [3425226] [DEBUG] 4 workers
[2024-03-20 21:07:48 +0800] [3425227] [INFO] Started server process [3425227]
[2024-03-20 21:07:48 +0800] [3425227] [INFO] Waiting for application startup.
[2024-03-20 21:07:48 +0800] [3425227] [INFO] Application startup complete.
[2024-03-20 21:07:48 +0800] [3425228] [INFO] Started server process [3425228]
[2024-03-20 21:07:48 +0800] [3425228] [INFO] Waiting for application startup.
[2024-03-20 21:07:48 +0800] [3425228] [INFO] Application startup complete.
[2024-03-20 21:07:48 +0800] [3425229] [INFO] Started server process [3425229]
[2024-03-20 21:07:48 +0800] [3425229] [INFO] Waiting for application startup.
[2024-03-20 21:07:48 +0800] [3425229] [INFO] Application startup complete.
[2024-03-20 21:07:48 +0800] [3425230] [INFO] Started server process [3425230]
[2024-03-20 21:07:48 +0800] [3425230] [INFO] Waiting for application startup.
[2024-03-20 21:07:48 +0800] [3425230] [INFO] Application startup complete.
[2024-03-21 09:33:24 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-21 09:33:37 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-21 09:33:44 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-21 09:33:45 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-22 14:05:59 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-22 14:05:59 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-22 14:05:59 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-22 14:06:52 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-22 14:06:52 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-23 11:04:29 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 5}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-23 11:04:38 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-23 11:04:38 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-23 11:04:38 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-24 13:59:30 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-24 13:59:30 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-24 13:59:30 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-24 13:59:35 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-24 13:59:35 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-25 17:16:18 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-25 17:16:18 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-25 17:16:18 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-25 17:17:32 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-26 11:25:49 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-26 11:25:49 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-26 11:26:36 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-27 22:26:51 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-31 11:04:08 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-31 11:04:08 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-03-31 11:13:48 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-04-09 14:44:40 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-04-09 14:44:40 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-04-09 14:44:40 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-04-09 14:45:17 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-04-30 14:34:40 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-04-30 14:34:40 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-04-30 14:34:40 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-04-30 16:07:56 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-05-05 20:30:23 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-05-05 20:30:36 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-05-05 20:30:36 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-05-15 22:22:27 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-05-15 22:22:30 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-05-15 22:22:38 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-06-05 18:30:49 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-06-05 18:30:49 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-07-12 14:57:53 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 56, in get_WT_gene_activity
    data, records_sum = crud.get_WT_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 85, in get_WT_gene_activity
    query_data = db.query(WT_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_WT_mat`.id AS `comb_norm_WT_mat_id`, `comb_norm_WT_mat`.gene_symbol AS `comb_norm_WT_mat_gene_symbol`, `comb_norm_WT_mat`.cluster_0 AS `comb_norm_WT_mat_cluster_0`, `comb_norm_WT_mat`.cluster_1 AS `comb_norm_WT_mat_cluster_1`, `comb_norm_WT_mat`.cluster_2 AS `comb_norm_WT_mat_cluster_2`, `comb_norm_WT_mat`.cluster_3 AS `comb_norm_WT_mat_cluster_3`, `comb_norm_WT_mat`.cluster_4 AS `comb_norm_WT_mat_cluster_4`, `comb_norm_WT_mat`.cluster_5 AS `comb_norm_WT_mat_cluster_5`, `comb_norm_WT_mat`.cluster_6 AS `comb_norm_WT_mat_cluster_6`, `comb_norm_WT_mat`.cluster_7 AS `comb_norm_WT_mat_cluster_7` 
FROM `comb_norm_WT_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-07-12 14:58:03 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-07-12 14:58:04 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-07-19 13:50:09 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-07-19 13:50:10 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-07-19 13:50:16 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 63, in get_KO_gene_activity
    data, records_sum = crud.get_KO_gene_activity(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 95, in get_KO_gene_activity
    query_data = db.query(KO_gene_activity_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT `comb_norm_KO_mat`.id AS `comb_norm_KO_mat_id`, `comb_norm_KO_mat`.gene_symbol AS `comb_norm_KO_mat_gene_symbol`, `comb_norm_KO_mat`.cluster_0 AS `comb_norm_KO_mat_cluster_0`, `comb_norm_KO_mat`.cluster_1 AS `comb_norm_KO_mat_cluster_1`, `comb_norm_KO_mat`.cluster_2 AS `comb_norm_KO_mat_cluster_2`, `comb_norm_KO_mat`.cluster_3 AS `comb_norm_KO_mat_cluster_3`, `comb_norm_KO_mat`.cluster_4 AS `comb_norm_KO_mat_cluster_4`, `comb_norm_KO_mat`.cluster_5 AS `comb_norm_KO_mat_cluster_5`, `comb_norm_KO_mat`.cluster_6 AS `comb_norm_KO_mat_cluster_6`, `comb_norm_KO_mat`.cluster_7 AS `comb_norm_KO_mat_cluster_7` 
FROM `comb_norm_KO_mat` 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-07-19 13:55:11 +0800] [3425228] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-11-07 11:58:35 +0800] [3425230] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-11-07 11:58:35 +0800] [3425227] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 49, in get_barcodes_meta_data
    data, records_sum = crud.get_barcodes_meta_data(db, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 75, in get_barcodes_meta_data
    query_data = db.query(barcodes_meta_data).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")
[SQL: SELECT barcodes_meta_data.id AS barcodes_meta_data_id, barcodes_meta_data.barcode AS barcodes_meta_data_barcode, barcodes_meta_data.`nCount_peaks` AS `barcodes_meta_data_nCount_peaks`, barcodes_meta_data.`nFeature_peaks` AS `barcodes_meta_data_nFeature_peaks`, barcodes_meta_data.nucleosome_signal AS barcodes_meta_data_nucleosome_signal, barcodes_meta_data.nucleosome_percentile AS barcodes_meta_data_nucleosome_percentile, barcodes_meta_data.tss_enrichment AS barcodes_meta_data_tss_enrichment, barcodes_meta_data.tss_percentile AS barcodes_meta_data_tss_percentile, barcodes_meta_data.high_tss AS barcodes_meta_data_high_tss, barcodes_meta_data.seurat_clusters AS barcodes_meta_data_seurat_clusters, barcodes_meta_data.sample_type AS barcodes_meta_data_sample_type, barcodes_meta_data.`nCount_RNA` AS `barcodes_meta_data_nCount_RNA`, barcodes_meta_data.`nFeature_RNA` AS `barcodes_meta_data_nFeature_RNA` 
FROM barcodes_meta_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
[2024-11-07 11:59:51 +0800] [3425229] [ERROR] Exception in ASGI application
Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 760, in _write_bytes
    self._sock.sendall(data)
ConnectionResetError: [Errno 104] Connection reset by peer

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
pymysql.err.OperationalError: (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/applications.py", line 276, in __call__
    await super().__call__(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/fastapi/routing.py", line 165, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/data/wshao/scATACdb/code/main.py", line 38, in get_overall_data
    data, records_sum = crud.get_overall_data(db, filter, paging)
  File "/data/wshao/scATACdb/code/crud.py", line 65, in get_overall_data
    query_data = db.query(overall_data).filter(*filters).offset(paging_start).limit(paging_len).all()
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2688, in all
    return self._iter().all()  # type: ignore
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2842, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2231, in execute
    return self._execute_internal(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2126, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 292, in orm_execute_statement
    result = conn.execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1841, in _execute_context
    return self._exec_single_context(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 920, in do_execute
    cursor.execute(statement, parameters)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 158, in execute
    result = self._query(query)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/cursors.py", line 325, in _query
    conn.query(q)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 548, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 818, in _execute_command
    self._write_bytes(packet)
  File "/root/anaconda3/envs/fastapi/lib/python3.10/site-packages/pymysql/connections.py", line 763, in _write_bytes
    raise err.OperationalError(
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (ConnectionResetError(104, 'Connection reset by peer'))")
[SQL: SELECT overall_data.id AS overall_data_id, overall_data.geo_id AS overall_data_geo_id, overall_data.pb_gene AS overall_data_pb_gene, overall_data.pb_ensembl AS overall_data_pb_ensembl, overall_data.n_sample AS overall_data_n_sample, overall_data.celline AS overall_data_celline, overall_data.method AS overall_data_method, overall_data.conditions AS overall_data_conditions, overall_data.accession AS overall_data_accession, overall_data.datasource AS overall_data_datasource 
FROM overall_data 
 LIMIT %(param_1)s, %(param_2)s]
[parameters: {'param_1': 0, 'param_2': 10}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
